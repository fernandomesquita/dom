{
  "query": "\n-- 1. Tabela principal de materiais\nCREATE TABLE IF NOT EXISTS `materials` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `title` VARCHAR(255) NOT NULL,\n  `description` TEXT,\n  `thumbnailUrl` TEXT NOT NULL,\n  `category` ENUM('base', 'revisao', 'promo') NOT NULL,\n  `type` ENUM('video', 'pdf', 'audio') NOT NULL,\n  `isPaid` BOOLEAN DEFAULT FALSE NOT NULL,\n  `isAvailable` BOOLEAN DEFAULT TRUE NOT NULL,\n  `isFeatured` BOOLEAN DEFAULT FALSE NOT NULL,\n  `commentsEnabled` BOOLEAN DEFAULT TRUE NOT NULL,\n  `upvotes` INT DEFAULT 0 NOT NULL,\n  `viewCount` INT DEFAULT 0 NOT NULL,\n  `downloadCount` INT DEFAULT 0 NOT NULL,\n  `favoriteCount` INT DEFAULT 0 NOT NULL,\n  `rating` DECIMAL(3,2) DEFAULT 0.00,\n  `ratingCount` INT DEFAULT 0 NOT NULL,\n  `createdBy` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX `categoryIdx` (`category`),\n  INDEX `typeIdx` (`type`),\n  INDEX `isPaidIdx` (`isPaid`),\n  INDEX `isAvailableIdx` (`isAvailable`),\n  INDEX `isFeaturedIdx` (`isFeatured`),\n  INDEX `createdAtIdx` (`createdAt`),\n  INDEX `categoryPaidIdx` (`category`, `isPaid`, `isAvailable`),\n  INDEX `titleDescIdx` (`title`, `description`(255))\n);\n\n-- 2. Itens de materiais (múltiplos por material)\nCREATE TABLE IF NOT EXISTS `materialItems` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `title` VARCHAR(255) NOT NULL,\n  `type` ENUM('video', 'pdf', 'audio') NOT NULL,\n  `url` TEXT,\n  `filePath` TEXT,\n  `duration` INT,\n  `fileSize` INT,\n  `order` INT DEFAULT 0 NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `orderIdx` (`order`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 3. Links com Árvore DOM\nCREATE TABLE IF NOT EXISTS `materialLinks` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `disciplinaId` VARCHAR(36) NOT NULL,\n  `assuntoId` VARCHAR(36) NOT NULL,\n  `topicoId` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `mat_tree_idx` (`materialId`, `disciplinaId`, `assuntoId`, `topicoId`),\n  UNIQUE INDEX `mat_topico_uniq` (`materialId`, `topicoId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 4. Visualizações\nCREATE TABLE IF NOT EXISTS `materialViews` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `viewedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `ipAddress` VARCHAR(45),\n  `userAgent` TEXT,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  INDEX `viewedAtIdx` (`viewedAt`),\n  INDEX `materialTimeIdx` (`materialId`, `viewedAt`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 5. Downloads\nCREATE TABLE IF NOT EXISTS `materialDownloads` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `materialItemId` INT,\n  `userId` VARCHAR(36) NOT NULL,\n  `downloadedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `ipAddress` VARCHAR(45),\n  `pdfFingerprint` VARCHAR(64),\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  INDEX `downloadedAtIdx` (`downloadedAt`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE,\n  FOREIGN KEY (`materialItemId`) REFERENCES `materialItems`(`id`) ON DELETE CASCADE\n);\n\n-- 6. Upvotes\nCREATE TABLE IF NOT EXISTS `materialUpvotes` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE INDEX `userMaterialIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 7. Ratings\nCREATE TABLE IF NOT EXISTS `materialRatings` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `rating` INT NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  UNIQUE INDEX `userMaterialRatingIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 8. Favoritos\nCREATE TABLE IF NOT EXISTS `materialFavorites` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  UNIQUE INDEX `userMaterialFavIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 9. Marcações \"visto\"\nCREATE TABLE IF NOT EXISTS `materialSeenMarks` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `markedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  UNIQUE INDEX `userMaterialSeenIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 10. Comentários\nCREATE TABLE IF NOT EXISTS `materialComments` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `parentCommentId` INT,\n  `content` TEXT NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  INDEX `parentIdx` (`parentCommentId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE,\n  FOREIGN KEY (`parentCommentId`) REFERENCES `materialComments`(`id`) ON DELETE CASCADE\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3FZ1nxfVKsSpRCQ.c519e6f3483f --database E9go4Z3vKfQ64CyBjNz69u --execute \n-- 1. Tabela principal de materiais\nCREATE TABLE IF NOT EXISTS `materials` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `title` VARCHAR(255) NOT NULL,\n  `description` TEXT,\n  `thumbnailUrl` TEXT NOT NULL,\n  `category` ENUM('base', 'revisao', 'promo') NOT NULL,\n  `type` ENUM('video', 'pdf', 'audio') NOT NULL,\n  `isPaid` BOOLEAN DEFAULT FALSE NOT NULL,\n  `isAvailable` BOOLEAN DEFAULT TRUE NOT NULL,\n  `isFeatured` BOOLEAN DEFAULT FALSE NOT NULL,\n  `commentsEnabled` BOOLEAN DEFAULT TRUE NOT NULL,\n  `upvotes` INT DEFAULT 0 NOT NULL,\n  `viewCount` INT DEFAULT 0 NOT NULL,\n  `downloadCount` INT DEFAULT 0 NOT NULL,\n  `favoriteCount` INT DEFAULT 0 NOT NULL,\n  `rating` DECIMAL(3,2) DEFAULT 0.00,\n  `ratingCount` INT DEFAULT 0 NOT NULL,\n  `createdBy` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX `categoryIdx` (`category`),\n  INDEX `typeIdx` (`type`),\n  INDEX `isPaidIdx` (`isPaid`),\n  INDEX `isAvailableIdx` (`isAvailable`),\n  INDEX `isFeaturedIdx` (`isFeatured`),\n  INDEX `createdAtIdx` (`createdAt`),\n  INDEX `categoryPaidIdx` (`category`, `isPaid`, `isAvailable`),\n  INDEX `titleDescIdx` (`title`, `description`(255))\n);\n\n-- 2. Itens de materiais (múltiplos por material)\nCREATE TABLE IF NOT EXISTS `materialItems` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `title` VARCHAR(255) NOT NULL,\n  `type` ENUM('video', 'pdf', 'audio') NOT NULL,\n  `url` TEXT,\n  `filePath` TEXT,\n  `duration` INT,\n  `fileSize` INT,\n  `order` INT DEFAULT 0 NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `orderIdx` (`order`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 3. Links com Árvore DOM\nCREATE TABLE IF NOT EXISTS `materialLinks` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `disciplinaId` VARCHAR(36) NOT NULL,\n  `assuntoId` VARCHAR(36) NOT NULL,\n  `topicoId` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `mat_tree_idx` (`materialId`, `disciplinaId`, `assuntoId`, `topicoId`),\n  UNIQUE INDEX `mat_topico_uniq` (`materialId`, `topicoId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 4. Visualizações\nCREATE TABLE IF NOT EXISTS `materialViews` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `viewedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `ipAddress` VARCHAR(45),\n  `userAgent` TEXT,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  INDEX `viewedAtIdx` (`viewedAt`),\n  INDEX `materialTimeIdx` (`materialId`, `viewedAt`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 5. Downloads\nCREATE TABLE IF NOT EXISTS `materialDownloads` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `materialItemId` INT,\n  `userId` VARCHAR(36) NOT NULL,\n  `downloadedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `ipAddress` VARCHAR(45),\n  `pdfFingerprint` VARCHAR(64),\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  INDEX `downloadedAtIdx` (`downloadedAt`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE,\n  FOREIGN KEY (`materialItemId`) REFERENCES `materialItems`(`id`) ON DELETE CASCADE\n);\n\n-- 6. Upvotes\nCREATE TABLE IF NOT EXISTS `materialUpvotes` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  UNIQUE INDEX `userMaterialIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 7. Ratings\nCREATE TABLE IF NOT EXISTS `materialRatings` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `rating` INT NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  UNIQUE INDEX `userMaterialRatingIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 8. Favoritos\nCREATE TABLE IF NOT EXISTS `materialFavorites` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  UNIQUE INDEX `userMaterialFavIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 9. Marcações \"visto\"\nCREATE TABLE IF NOT EXISTS `materialSeenMarks` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `markedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  UNIQUE INDEX `userMaterialSeenIdx` (`userId`, `materialId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE\n);\n\n-- 10. Comentários\nCREATE TABLE IF NOT EXISTS `materialComments` (\n  `id` INT AUTO_INCREMENT PRIMARY KEY,\n  `materialId` INT NOT NULL,\n  `userId` VARCHAR(36) NOT NULL,\n  `parentCommentId` INT,\n  `content` TEXT NOT NULL,\n  `createdAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  `updatedAt` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX `materialIdx` (`materialId`),\n  INDEX `userIdx` (`userId`),\n  INDEX `parentIdx` (`parentCommentId`),\n  FOREIGN KEY (`materialId`) REFERENCES `materials`(`id`) ON DELETE CASCADE,\n  FOREIGN KEY (`parentCommentId`) REFERENCES `materialComments`(`id`) ON DELETE CASCADE\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 3263
}